rules:
  - id: spring-jsp-reflected-xss
    mode: join
    join:
      rules:
        - id: user-input
          languages:
            - java
          patterns:
            - pattern-inside: |
                @Controller
                class $CLASSNAME {
                    ...
                }
            - pattern-inside: |
                $METHODNAME(..., @$REQ(...) String $INPUT, Model $MODEL,...) {
                  ...
                  return "$VIEWNAME"
                }
            - metavariable-regex:
                metavariable: $REQ
                regex: (RequestBody|PathVariable|RequestParam|RequestHeader|CookieValue)
            - pattern: $MODEL.addAttribute("$VAR", $INPUT)
        - id: unescaped-output
          patterns:
            - pattern-regex: \$\{(?!.*escapeXml).*\}
            - pattern-not-inside: <$TAG:$FUNC $ATTR="..."
            - pattern: $VAR
          languages:
            - generic
      on:
        - "user-input.$VAR == unescaped-output.$VAR"
        - "user-input.$VIEWNAME < unescaped-output.path"
    paths:
      include:
        - "*.java"
        - "*.jsp"
        - "*.tag"
      exclude:
        - "src/test"
    message: |
      XSS vulnerability Detected.
    severity: ERROR
